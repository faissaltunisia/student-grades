<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدرسة المروج | سورة الإسراء</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --green: #004d40; --gold: #D4AF37; }
        body { font-family: 'Cairo', sans-serif; background: #fdfaf0; margin: 0; text-align: center; padding-bottom: 120px; }
        header { background: var(--green); color: white; padding: 20px; border-bottom: 5px solid var(--gold); }
        
        .mushaf-container { 
            background: white; margin: 15px; padding: 25px; 
            border-radius: 20px; border: 2px solid var(--gold); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .ayah { 
            font-family: 'Amiri'; font-size: 1.8rem; line-height: 2.5; 
            transition: 0.3s; padding: 5px; display: inline; color: #333;
        }

        /* تمييز الآية أثناء القراءة */
        .active { background: var(--gold); color: white; border-radius: 10px; }
        
        /* زر التشغيل "القنبلة" */
        .controls-fixed { 
            position: fixed; bottom: 30px; width: 100%; 
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        
        .main-btn { 
            background: var(--green); color: white; border: 3px solid var(--gold);
            padding: 18px 45px; border-radius: 50px; font-size: 1.4rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .progress-container {
            width: 80%; max-width: 400px; height: 8px; background: #ddd;
            border-radius: 10px; overflow: hidden; border: 1px solid var(--gold);
        }
        #progressBar { width: 0%; height: 100%; background: var(--gold); transition: 0.1s; }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size:1.1rem;">مدرسة المروج للتعليم الأساسي</h1>
    <p style="margin:0; color:var(--gold); font-size:0.8rem;">سورة الإسراء - المصحف المعلم</p>
</header>

<div class="mushaf-container">
    <div id="mushaf">
        </div>
</div>

<div class="controls-fixed">
    <div class="progress-container">
        <div id="progressBar"></div>
    </div>
    <button class="main-btn" onclick="handleAudio()" id="playBtn">▶ تشغيل السورة</button>
</div>

<audio id="quranAudio" crossorigin="anonymous">
    <source src="https://server11.mp3quran.net/huzaifi/017.mp3" type="audio/mpeg">
</audio>

<script>
    // بيانات الآيات مع توقيتاتها (سورة الإسراء)
    const suraData = [
        { id: 1, text: "سُبْحَانَ الَّذِي أَسْرَىٰ بِعَبْدِهِ لَيْلًا مِّنَ الْمَسْجِدِ الْحَرَامِ إِلَى الْمَسْجِدِ الْأَقْصَى الَّذِي بَارَكْنَا حَوْلَهُ لِنُرِيَهُ مِنْ آيَاتِنَا ۚ إِنَّهُ هُوَ السَّمِيعُ الْبَصِيرُ ﴿١﴾", start: 0, end: 20 },
        { id: 2, text: "وَآتَيْنَا مُوسَى الْكِتَابَ وَجَعَلْنَاهُ هُدًى لِّبَنِي إِسْرَائِيلَ أَلَّا تَتَّخِذُوا مِن دُونِي وَكِيلًا ﴿٢﴾", start: 20, end: 34 },
        { id: 3, text: "ذُرِّيَّةَ مَنْ حَمَلْنَا مَعَ نُوحٍ ۚ إِنَّهُ كَانَ عَبْدًا شَكُورًا ﴿٣﴾", start: 34, end: 44 },
        { id: 4, text: "وَقَضَيْنَا إِلَىٰ بَنِي إِسْرَائِيلَ فِي الْكِتَابِ لَتُفْسِدُنَّ فِي الْأَرْضِ مَرَّتَيْنِ وَلَتَعْلُوَنَّ عُلُوًّا كَبِيرًا ﴿٤﴾", start: 44, end: 60 }
        // سيستمر الصوت تلقائياً حتى نهاية السورة (111 آية)
    ];

    const audio = document.getElementById('quranAudio');
    const playBtn = document.getElementById('playBtn');
    const progressBar = document.getElementById('progressBar');
    const mushaf = document.getElementById('mushaf');

    // عرض الآيات
    mushaf.innerHTML = suraData.map(a => `<span class="ayah" id="a-${a.id}">${a.text}</span>`).join(' ');

    function handleAudio() {
        if (audio.paused) {
            // سر "الكود القنبلة": إعادة التحميل الإجباري عند كل ضغطة
            if (audio.currentTime === 0) audio.load(); 
            
            audio.play().then(() => {
                playBtn.innerText = "⏸ إيقاف مؤقت";
                playBtn.style.background = "#c62828"; // لون أحمر عند التشغيل
            }).catch(e => {
                // محاولة تشغيل اضطرارية برابط احتياطي
                audio.src = "https://download.quranicaudio.com/quran/huzaifi/017.mp3";
                audio.play();
            });
        } else {
            audio.pause();
            playBtn.innerText = "▶ تشغيل السورة";
            playBtn.style.background = "#004d40";
        }
    }

    // تتبع الوقت والمزامنة
    audio.ontimeupdate = () => {
        const now = audio.currentTime;
        
        // تحديث شريط التقدم
        const percent = (now / audio.duration) * 100;
        progressBar.style.width = percent + "%";

        // مزامنة النص
        suraData.forEach(a => {
            const el = document.getElementById(`a-${a.id}`);
            if (now >= a.start && now < a.end) {
                document.querySelectorAll('.ayah').forEach(item => item.classList.remove('active'));
                el.classList.add('active');
                
                // تمرير تلقائي عند بداية الآية
                if (now - a.start < 0.3) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    };

    // إعادة التشغيل عند الانتهاء
    audio.onended = () => {
        playBtn.innerText = "▶ إعادة التشغيل";
        progressBar.style.width = "0%";
    };
</script>

</body>
</html>
