<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة مدرسة المروج | التتبع الصوتي الكامل</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --royal-green: #004d40; --gold: #D4AF37; --bg: #fdfaf0; }
        * { box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        
        header { 
            background: linear-gradient(135deg, var(--royal-green), #002d26);
            color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--gold);
        }

        .container { padding: 15px; max-width: 600px; margin: auto; }

        /* منطقة المصحف */
        .quran-container {
            background: white; border-radius: 20px; padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1.5px solid var(--gold);
            text-align: center;
        }

        .sura-text {
            font-family: 'Amiri'; font-size: 1.8rem; line-height: 2.5;
            text-align: justify; direction: rtl; margin-bottom: 25px;
            color: #333;
        }

        /* تنسيق الآية النشطة */
        .ayah { padding: 0 5px; border-radius: 5px; transition: 0.4s; display: inline; }
        .active-ayah { background: var(--gold); color: white; box-shadow: 0 2px 8px rgba(212, 175, 55, 0.5); }

        .controls {
            position: sticky; bottom: 20px; background: white;
            padding: 15px; border-radius: 50px; border: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: center; gap: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .btn-play {
            background: var(--royal-green); color: white; border: none;
            width: 60px; height: 60px; border-radius: 50%; font-size: 1.5rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size:1.3rem; color:var(--gold);">مدرسة المروج للتعليم الأساسي</h1>
    <p style="margin:0; font-size:0.8rem;">تتبع تلاوة سورة المعارج (1-10)</p>
</header>

<div class="container">
    <div class="quran-container">
        <h2 style="color:var(--royal-green); font-family:'Amiri';">سورة المعارج</h2>
        <div id="mushaf" class="sura-text">
            </div>
    </div>
</div>

<div class="container">
    <div class="controls">
        <button class="btn-play" onclick="toggleAudio()" id="playBtn">▶</button>
        <div style="flex:1; text-align:right;">
            <div id="status" style="font-size:0.9rem; font-weight:bold; color:var(--royal-green);">اضغط للبدء</div>
            <div id="progress" style="height:4px; background:#eee; width:100%; margin-top:5px;">
                <div id="bar" style="height:100%; background:var(--gold); width:0%;"></div>
            </div>
        </div>
    </div>
</div>

<audio id="audioSource" preload="auto">
    <source src="https://server11.mp3quran.net/huzaifi/070.mp3" type="audio/mpeg">
</audio>

<script>
    // بيانات الآيات وتوقيتاتها (سورة المعارج - الشيخ الحذيفي)
    const suraData = [
        { id: 1, text: "سَأَلَ سَائِلٌ بِعَذَابٍ وَاقِعٍ ﴿١﴾", start: 0, end: 5.5 },
        { id: 2, text: "لِّلْكَافِرِينَ لَيْسَ لَهُ دَافِعٌ ﴿٢﴾", start: 5.5, end: 11.5 },
        { id: 3, text: "مِّنَ اللَّهِ ذِي الْمَعَارِجِ ﴿٣﴾", start: 11.5, end: 16.5 },
        { id: 4, text: "تَعْرُجُ الْمَلَائِكَةُ وَالرُّوحُ إِلَيْهِ فِي يَوْمٍ كَانَ مِقْدَارُهُ خَمْسِينَ أَلْفَ سَنَةٍ ﴿٤﴾", start: 16.5, end: 28.0 },
        { id: 5, text: "فَاصْبِرْ صَبْرًا جَمِيلًا ﴿٥﴾", start: 28.0, end: 32.5 },
        { id: 6, text: "إِنَّهُمْ يَرَوْنَهُ بَعِيدًا ﴿٦﴾", start: 32.5, end: 36.5 },
        { id: 7, text: "وَنَرَاهُ قَرِيبًا ﴿٧﴾", start: 36.5, end: 40.5 },
        { id: 8, text: "يَوْمَ تَكُونُ السَّمَاءُ كَالْمُهْلِ ﴿٨﴾", start: 40.5, end: 46.5 },
        { id: 9, text: "وَتَكُونُ الْجِبَالُ كَالْعِهْنِ ﴿٩﴾", start: 46.5, end: 52.0 },
        { id: 10, text: "وَلَا يَسْأَلُ حَمِيمٌ حَمِيمًا ﴿١٠﴾", start: 52.0, end: 58.0 }
    ];

    const audio = document.getElementById('audioSource');
    const playBtn = document.getElementById('playBtn');
    const statusText = document.getElementById('status');
    const mushaf = document.getElementById('mushaf');

    // 1. عرض السورة نصياً عند التشغيل
    function loadSura() {
        mushaf.innerHTML = suraData.map(a => `<span class="ayah" id="ayah-${a.id}">${a.text}</span>`).join(' ');
    }

    // 2. معالجة تشغيل الصوت (حل مشكلة الحظر)
    function toggleAudio() {
        if (audio.paused) {
            audio.play().then(() => {
                playBtn.innerText = "⏸";
                statusText.innerText = "جاري التلاوة والتتبع...";
            }).catch(e => {
                alert("يرجى الضغط مرة أخرى لتفعيل الصوت في المتصفح");
            });
        } else {
            audio.pause();
            playBtn.innerText = "▶";
            statusText.innerText = "تم الإيقاف مؤقتًا";
        }
    }

    // 3. محرك المزامنة (تغيير لون الآية مع الصوت)
    audio.ontimeupdate = () => {
        const currentTime = audio.currentTime;
        
        // تحديث شريط التقدم
        const progress = (audio.currentTime / audio.duration) * 100;
        document.getElementById('bar').style.width = progress + "%";

        // البحث عن الآية الحالية
        suraData.forEach(ayah => {
            const el = document.getElementById(`ayah-${ayah.id}`);
            if (currentTime >= ayah.start && currentTime < ayah.end) {
                // إزالة التمييز من الجميع وإضافته للآية الحالية
                document.querySelectorAll('.ayah').forEach(a => a.classList.remove('active-ayah'));
                el.classList.add('active-ayah');
                
                // التمرير التلقائي في الهاتف ليظل النص ظاهراً
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    };

    window.onload = loadSura;
</script>

</body>
</html>
