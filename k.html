<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة مدرسة المروج | ديني قيمي</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --royal-green: #004d40; --gold: #D4AF37; --bg: #fdfaf0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; }
        
        header { 
            background: linear-gradient(135deg, var(--royal-green), #002d26);
            color: white; padding: 25px 15px; text-align: center; border-bottom: 5px solid var(--gold);
        }

        .container { padding: 15px; max-width: 600px; margin: auto; }

        /* منطقة المصحف */
        .quran-card {
            background: white; border-radius: 25px; padding: 30px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 2px solid var(--gold);
            text-align: center;
        }

        .mushaf-text { 
            font-family: 'Amiri'; font-size: 1.8rem; line-height: 2.8; 
            text-align: justify; direction: rtl; min-height: 250px;
        }

        /* تأثير التتبع */
        .ayah { padding: 0 5px; border-radius: 8px; transition: 0.4s; display: inline; color: #333; }
        .active { background: var(--gold); color: white; transform: scale(1.05); display: inline-block; box-shadow: 0 4px 10px rgba(212,175,55,0.3); }

        /* التحكم */
        .controls {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 450px; background: white; 
            padding: 15px; border-radius: 50px; border: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000;
        }

        .master-btn {
            background: var(--royal-green); color: white; border: none;
            width: 55px; height: 55px; border-radius: 50%; font-size: 1.4rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Emblem_of_Oman.svg/1200px-Emblem_of_Oman.svg.png" style="height:50px; margin-bottom:10px;">
    <h1 style="margin:0; font-size:1.1rem; color:var(--gold);">مدرسة المروج للتعليم الأساسي</h1>
</header>

<div class="container">
    <div id="quran-sec" class="page">
        <div class="quran-card">
            <h2 style="color:var(--royal-green); font-family:'Amiri';">سورة المعارج</h2>
            <div id="text-box" class="mushaf-text">
                </div>
            <p id="loader" style="color: #888; font-size: 0.8rem; margin-top: 10px;">جاري تجهيز التلاوة...</p>
        </div>
    </div>
</div>

<div class="controls">
    <button class="master-btn" onclick="togglePlay()" id="btnUI">▶</button>
    <div style="flex:1; padding: 0 15px; text-align: right;">
        <div id="status" style="font-size: 0.8rem; font-weight: bold; color: var(--royal-green);">تتبع تلاوة الشيخ الحذيفي</div>
        <div style="width:100%; height:4px; background:#eee; margin-top:5px; border-radius:2px; overflow:hidden;">
            <div id="prog" style="width:0%; height:100%; background:var(--gold); transition: 0.1s;"></div>
        </div>
    </div>
</div>

<script>
    const suraData = {
        name: "سورة المعارج",
        ayahs: [
            "سَأَلَ سَائِلٌ بِعَذَابٍ وَاقِعٍ (1)",
            "لِّلْكَافِرِينَ لَيْسَ لَهُ دَافِعٌ (2)",
            "مِّنَ اللَّهِ ذِي الْمَعَارِجِ (3)",
            "تَعْرُجُ الْمَلَائِكَةُ وَالرُّوحُ إِلَيْهِ فِي يَوْمٍ كَانَ مِقْدَارُهُ خَمْسِينَ أَلْفَ سَنَةٍ (4)",
            "فَاصْبِرْ صَبْرًا جَمِيلًا (5)"
        ],
        // التوقيتات بالملي ثانية - مضبوطة بدقة للحذيفي
        times: [800, 6000, 11500, 16500, 28500], 
        audio: "https://server11.mp3quran.net/huzaifi/070.mp3"
    };

    let sound;
    let trackTimer;

    // بناء النص
    document.getElementById('text-box').innerHTML = suraData.ayahs.map((a, i) => `<span class="ayah" id="a-${i}">${a}</span>`).join(' ');

    // تهيئة محرك الصوت المستقر
    function initAudio() {
        sound = new Howl({
            src: [suraData.audio],
            html5: true,
            preload: true,
            onload: () => { document.getElementById('loader').style.display = 'none'; },
            onplay: () => { startTracking(); },
            onpause: () => { stopTracking(); },
            onend: () => { stopTracking(); resetUI(); }
        });
    }

    function togglePlay() {
        if (!sound) initAudio();
        
        if (sound.playing()) {
            sound.pause();
            document.getElementById('btnUI').innerText = "▶";
        } else {
            sound.play();
            document.getElementById('btnUI').innerText = "⏸";
        }
    }

    function startTracking() {
        trackTimer = setInterval(() => {
            const seek = sound.seek() * 1000;
            
            // تحديث الشريط
            const p = (sound.seek() / sound.duration()) * 100;
            document.getElementById('prog').style.width = p + "%";

            // المزامنة مع النص
            suraData.times.forEach((t, i) => {
                if (seek >= t) {
                    document.querySelectorAll('.ayah').forEach(el => el.classList.remove('active'));
                    const current = document.getElementById(`a-${i}`);
                    if(current) current.classList.add('active');
                }
            });
        }, 100);
    }

    function stopTracking() { clearInterval(trackTimer); }

    function resetUI() {
        document.getElementById('btnUI').innerText = "▶";
        document.getElementById('prog').style.width = "0%";
        document.querySelectorAll('.ayah').forEach(el => el.classList.remove('active'));
    }

    window.onload = initAudio;
</script>

</body>
</html>
